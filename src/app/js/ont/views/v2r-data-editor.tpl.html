<uib-tabset style="width: 100%">

  <uib-tab ng-repeat="vocab in vocabs track by $index"
           style="cursor: pointer">

    <tab-heading>

      <div>
        <button ng-click="editVocabClass(vocab.class)" class="btn btn-link"
                ng-disabled="someEditInProgress() || attrTableform.$waiting">
          {{getName(vocab.class)}} <i class="fa fa-edit" aria-hidden="true"></i>
        </button>
      </div>

    </tab-heading>


    <table class="table table-bordered">
      <thead>
      <tr class="effect1">

        <th style="width: 5px">
        </th>

        <th style="vertical-align: middle">ID</th>

        <th ng-repeat="p in vocab.properties track by $index" ng-init="p_index=$index">
          <button ng-click="editVocabProperty(p)" class="btn btn-link"
                  ng-disabled="someEditInProgress() || attrTableform.$waiting">
            {{getLabel(p)}} <i class="fa fa-edit" aria-hidden="true"></i>
          </button>

          <div class="btn-group" uib-dropdown>
            <button type="button" class="btn btn-default btn-xs dropdown-toggle" uib-dropdown-toggle>
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="opt in columnMenu">
                <a href ng-bind="opt" ng-click="columnOptionSelected(vocab, p_index, opt)"></a>
              </li>
            </ul>
          </div>

        </th>

        <td style="width: 5px">
          <button type="button"
                  ng-disabled="someEditInProgress() || attrTableform.$waiting"
                  ng-click="addProperty(vocab)"
                  class="btn btn-default btn-xs"
                  uib-tooltip="Add property"
                  tooltip-placement="left"
          >
            <i class="fa fa-plus" aria-hidden="true"></i>
          </button>

        </td>
      </tr>
      </thead>

      <tbody>
      <tr ng-repeat="term in vocab.terms track by $index" ng-init="t_index = $index">

        <td style="width: 5px">
          <button type="button"
                  ng-disabled="someEditInProgress() || attrTableform.$waiting"
                  ng-click="removeTerm(vocab, t_index)"
                  class="btn btn-danger btn-xs"
                  uib-tooltip="Remove this term"
                  tooltip-placement="right"
          >
            <i class="fa fa-remove" aria-hidden="true"></i>
          </button>
        </td>

        <td >
          <span ng-if="someEditInProgress() || attrTableform.$waiting"
                ng-bind="term.name"
          ></span>
          <span ng-if="!(someEditInProgress() || attrTableform.$waiting)"
                editable-text="term.name" buttons="no" onbeforesave="checkTermId($data)"
                ng-bind="term.name || 'empty'"
          >
          </span>
        </td>

        <td ng-repeat="a in term.attributes track by $index" ng-init="a_index = $index"
            ng-class="{'cell-editing': attrTableform.$visible}"
        >
          <div ng-init="em = getAttrEditModel(a)">

            <div>
              <form editable-form name="attrTableform"
                    onaftersave="applyCellChanges(term, a_index, em)"
                    oncancel="cancelCell(em)">

                <table class="table table-condensed"
                       ng-class="{'table-hover': !attrTableform.$visible, 'transparent': attrTableform.$visible}"
                       ng-click="enterCellEditing(attrTableform)"
                       uib-tooltip="{{!attrTableform.$visible && !someEditInProgress() ? 'Click to edit the value(s) for this property' : ''}}"
                >
                  <tr ng-repeat="valueEntry in em | filter:filterValue track by $index">

                    <td ng-show="attrTableform.$visible" style="width: 5px">
                      <button type="button" ng-click="deleteValue(em, valueEntry.id)"
                              class="btn btn-danger btn-xs"
                              uib-tooltip="Remove this value"
                              tooltip-placement="left"
                      >
                        <i class="fa fa-times" aria-hidden="true"></i>
                      </button>
                    </td>

                    <td>
                      <span editable-textarea="valueEntry.value"
                            e-rows="2"
                            e-form="attrTableform"
                            ng-bind="valueEntry.value || 'empty'"
                      >
                      </span>
                      <!--<pre ng-bind="'valueEntry=' +(valueEntry|json)"></pre>-->
                    </td>
                  </tr>
                </table>

                <span ng-show="attrTableform.$visible">
                    <button type="button" ng-disabled="attrTableform.$waiting"
                            ng-click="addValue(em)"
                            class="btn btn-default btn-xs"
                    >
                      <i class="fa fa-plus" aria-hidden="true"></i> Add value
                    </button>

                    <button type="submit" ng-disabled="attrTableform.$waiting"
                            class="btn btn-default btn-xs"
                            uib-tooltip="Apply all changes in this cell"
                    >
                      <i class="fa fa-check" aria-hidden="true"></i> Apply
                    </button>

                    <button type="button" ng-disabled="attrTableform.$waiting"
                            class="btn btn-default btn-xs"
                            ng-click="attrTableform.$cancel()"
                            uib-tooltip="Cancel all changes to this cell"
                    >
                      Cancel
                    </button>
                </span>

              </form>
            </div>

          </div>
          <pre ng-if="debug">em={{em|json}}</pre>
        </td>

      </tr>

      <tr>
        <td style="text-align: center">
          <button type="button"
                  ng-disabled="someEditInProgress() || attrTableform.$waiting"
                  ng-click="addTerm(vocab)"
                  class="btn btn-default btn-xs"
                  uib-tooltip="Add term"
                  tooltip-placement="right"
          >
            <i class="fa fa-plus" aria-hidden="true"></i>
          </button>
        </td>
      </tr>

      </tbody>
    </table>

    <div ng-if="debug" class="debug">
      <pre>vocab = {{vocab | json}}</pre>
    </div>

  </uib-tab>

</uib-tabset>
